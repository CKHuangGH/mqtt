apiVersion: apps/v1
kind: Deployment
metadata:
  name: runnermqtt1
  labels:
    app: runner
spec:
  replicas: 1
  selector:
    matchLabels:
      app: runner
  template:
    metadata:
      labels:
        app: runner
    spec:
      securityContext:
        sysctls:
          - name: net.core.rmem_default
            value: "67108864"     # 64 MB (從 8MB 拉高)
          - name: net.core.rmem_max
            value: "134217728"    # 128 MB (保留)
          - name: net.core.wmem_default
            value: "8388608"      # 8 MB (從 2MB 拉高)
          - name: net.core.wmem_max
            value: "134217728"    # 128 MB
          - name: net.core.netdev_max_backlog
            value: "65536"        # 由 32768 加倍
      nodeSelector:
        worker: "2"
      hostname: runnermqtt1
      subdomain: benchnet
      containers:
        - env:
            - name: ADD_NODE_TO_SUFFIX
              value: "false"
            - name: DEPLOY_DIR
              value: /app/configs/builtin-test-suites/deployments
            - name: DEVICE_DIR
              value: /app/configs/builtin-test-suites/devices
            - name: DIST_MODE
              value: name
            - name: NODE_BASE
              value: runner1
            - name: RELEASE_COOKIE
              value: ps_bench_cookie
            - name: RUN_TAG
              value: dds_test
            - name: SCENARIO
              value: protocolsuite_smart_city_dds
            - name: SCEN_DIR
              value: /app/configs/builtin-test-suites/testcases
          image: docker.io/library/ps_bench-runner:latest
          imagePullPolicy: Never
          name: runnermqtt1
          volumeMounts:
            - name: shared
              mountPath: /app/out
              subPath: out
            - name: shared
              mountPath: /app/results
              subPath: result
      volumes:
        - name: shared
          persistentVolumeClaim:
            claimName: runnermqtt1-shared-pvc
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: runnermqtt1-shared-pvc
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 10Gi
  storageClassName: local-path